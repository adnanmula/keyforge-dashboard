{% extends "Keyforge/Shared/keyforge_base.html.twig" %}

{% block title %}Games{% endblock %}

{% block body %}
    <div class="shadow-lg p-3 mb-5 bg-white rounded">
        <div class="divider py-2"></div>
        <h3>Games of {{ name }}</h3>
        <div class="divider py-2"></div>

        <div class="row mt-3">
            <div class="col-12 col-sm-6 col-lg-3">
                <canvas id="winRateVsUsers" height="310"></canvas>
            </div>
            <div class="col-12 col-sm-12 col-lg-9">
                <canvas id="winsByDate" height="100"></canvas>
            </div>
        </div>

        <div class="row m-2">
            {% if (null != best_deck) %}
                <a href="/keyforge/games/deck/{{ best_deck.id }}" class="btn btn-dark col-3 border col-12 col-sm-6 col-lg-3">
                    <h5>Best performance</h5>
                    <p>{{ best_deck.name }}</p>
                    <p>{{ best_deck.wins }}/{{ best_deck.losses }} (WR: {{ best_deck.win_rate }}%/PR: {{ best_deck.pick_rate }}%)</p>
                </a>
            {% endif %}

            {% if (null != worse_deck) %}
                <a href="/keyforge/games/deck/{{ worse_deck.id }}" class="btn btn-dark border col-12 col-sm-6 col-lg-3">
                    <h5>Worse performance</h5>
                    <p>{{ worse_deck.name }}</p>
                    <p>{{ worse_deck.wins }}/{{ worse_deck.losses }} (WR: {{ worse_deck.win_rate }}%/PR: {{ worse_deck.pick_rate }}%)</p>
                </a>
            {% endif %}
        </div>

        <div class="divider py-2"></div>

        {% include 'Keyforge/Stats/Game/list_games.html.twig' %}
    </div>
    <script>
        let winRateVsUsers = JSON.parse('{{ win_rate_vs_users|json_encode|raw }}');
        let pickRateVsUsers = JSON.parse('{{ pick_rate_vs_users|json_encode|raw }}');
        let winsByDate = JSON.parse('{{ wins_by_date|json_encode|raw }}');
        let lossesByDate = JSON.parse('{{ losses_by_date|json_encode|raw }}');

        const winRateVsUsersChart = new Chart(document.getElementById('winRateVsUsers').getContext('2d'), {
            type: 'bar',
            data: {
                labels: Object.keys(winRateVsUsers),
                datasets: [
                    {
                        label: 'WinRate%',
                        data: Object.values(winRateVsUsers),
                        borderColor: 'rgb(37, 41, 33)',
                        backgroundColor: 'rgb(37, 41, 33)',
                    },
                    {
                        label: 'PickRate%',
                        data: Object.values(pickRateVsUsers),
                        borderColor: 'rgb(37, 41, 33)',
                        backgroundColor: 'rgb(37, 41, 33)',
                    },
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false,
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'Win/Pick Rate'
                    }
                }
            },
        });

        const winsByDateChart = new Chart(document.getElementById('winsByDate').getContext('2d'), {
            type: 'bar',
            data: {
                labels: Object.keys(winsByDate),
                datasets: [
                    {
                        label: 'Wins',
                        data: Object.values(winsByDate),
                        borderColor: 'rgb(70,113,26)',
                        backgroundColor: 'rgb(70,113,26)',
                    },
                    {
                        label: 'Losses',
                        data: Object.values(lossesByDate),
                        borderColor: 'rgb(148,22,68)',
                        backgroundColor: 'rgb(148,22,68)',
                    },
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false,
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'Wins/Losses along time',
                    }
                }
            },
        });
    </script>
{% endblock %}