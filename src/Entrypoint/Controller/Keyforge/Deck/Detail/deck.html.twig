{% block header %}
    <style>
        .img_stat {
            width: 50px;
            height: 50px;
        }

        .tooltip.show {
            opacity: 1;
        }

        .card_name {
            display: inline-block;
            text-overflow: ellipsis;
            overflow:hidden;
            white-space:nowrap;
            margin-left: 5px;
            vertical-align: middle;
            font-size: 1.2em;
            min-width: 0;
        }

        @media (min-width: 501px) {
            .card_name {
                max-width: 300px;
            }
        }

        @media (max-width: 500px) {
            .card_name {
                max-width: 150px;
            }
        }

        @media (max-width: 450px) {
            .card_name {
                max-width: 100px;
            }
        }

        @media (max-width: 400px) {
            .card_name {
                max-width: 80px;
            }
        }

        @media (max-width: 280px) {
            .card_name {
                max-width: 60px;
            }
        }

        @media (max-width: 255px) {
            .card_name {
                max-width: 40px;
            }
        }
    </style>
{% endblock %}
<div class="shadow-lg p-3 mb-5 bg-white rounded">
    <div class="row">
        <div class="col-12 col-md-11">
            <h2>{{ deck.name }}</h2>
        </div>
        <div class="d-flex col-12 col-md-1 justify-content-end">
            <h2 style="margin-top: 5px">{{ deck.sas }}</h2>
            <img style="margin-bottom: 15px" width="40px" src="/assets/keyforge/sets/{{ deck.set }}.svg" alt="{{ deck.set }}"/>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="row">
                <div class="col-12 col-lg-4" style="margin-top: 10px">
                    <img width="33px" src="/assets/keyforge/houses/{{ deck.houses.0 }}.png" alt="{{ deck.houses.0 }}"/><span style="font-size: 1.5em; vertical-align: middle; margin-left: 4px">{{ deck.houses.0 }}</span>
                    <div class="row">
                        {% for card in deck.data.cards.firstPodCards %}
                            <div class="col-6 col-lg-12">
                                <img width="18px" src="/assets/keyforge/rarities/{{ card.rarity }}.svg" alt="{{ card.rarity }}" class="img-fluid"/>
                                <span class="card_name" data-bs-toggle="modal" data-bs-target="#card_image" data-card="{{ card.name }}" data-card-serialized="{{ card.serializedName }}">{{ card.name }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="col-12 col-lg-4" style="margin-top: 10px">
                    <img width="33px" src="/assets/keyforge/houses/{{ deck.houses.1 }}.png" alt="{{ deck.houses.1 }}"/><span style="font-size: 1.5em; vertical-align: middle; margin-left: 4px">{{ deck.houses.1 }}</span>
                    <div class="row">
                        {% for card in deck.data.cards.secondPodCards %}
                            <div class="col-6 col-lg-12" style="display: block">
                                <img width="18px" src="/assets/keyforge/rarities/{{ card.rarity }}.svg" alt="{{ card.rarity }}" class="img-fluid"/>
                                <span class="card_name" data-bs-toggle="modal" data-bs-target="#card_image" data-card="{{ card.name }}" data-card-serialized="{{ card.serializedName }}">{{ card.name }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="col-12 col-lg-4" style="margin-top: 10px">
                    <img width="33px" src="/assets/keyforge/houses/{{ deck.houses.2 }}.png" alt="{{ deck.houses.2 }}"/><span style="font-size: 1.5em; vertical-align: middle; margin-left: 4px">{{ deck.houses.2 }}</span>
                    <div class="row">
                        {% for card in deck.data.cards.thirdPodCards %}
                            <div class="col-6 col-lg-12">
                                <img width="18px" src="/assets/keyforge/rarities/{{ card.rarity }}.svg" alt="{{ card.rarity }}" class="img-fluid"/>
                                <span class="card_name" data-bs-toggle="modal" data-bs-target="#card_image" data-card="{{ card.name }}" data-card-serialized="{{ card.serializedName }}">{{ card.name }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="divider py-2"></div>

{#        <div class="row">#}
{#            <h2>Stats</h2>#}

{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Control de ambar">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.amberControl }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/amber_control.svg') }}" alt="Amber control" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Control de artefactos">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.artifactControl }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/artifact_control.svg') }}" alt="Artifact control" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Ambar esperado">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.expectedAmber }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/expected_amber.svg') }}" alt="Expected amber" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Control de criaturas">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.creatureControl }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/creature_control.svg') }}" alt="Creature control" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Eficiencia">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.efficiency }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/efficiency.svg') }}" alt="Efficiency" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Poder efectivo">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.effectivePower }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/power.svg') }}" alt="Effective power" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Recursión">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.recursion }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/recursion.svg') }}" alt="Recursion" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Protección de criaturas">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.creatureProtection }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/creature_protection.svg') }}" alt="Creature protection" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Disrupción">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.disruption }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/disruption.svg') }}" alt="Disruption" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            <div class="col-3">#}
{#                <div data-toggle="tooltip" title="Otros">#}
{#                    <div class="row">#}
{#                        <div class="col-12" style="font-size: 1.6em">#}
{#                            {{ deck.data.other }}#}
{#                            <img src="{{ asset('assets/keyforge/logos/other.svg') }}" alt="Other" class="img_stat"/>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
    </div>

    {% if is_granted('ROLE_KEYFORGE') %}
        {% if deck_notes is not null %}
            <div class="divider py-1"></div>
            <textarea class="form-control" name="notes" id="deckNotesInputDisabled" rows="8" maxlength="512" disabled>{{ deck_notes }}</textarea>
            <div class="divider py-1"></div>
        {% endif %}
    {% endif %}

    <div class="d-flex flex-row-reverse">
        <a href="https://archonarcana.com/Deck:{{ reference }}" target="_blank"><img class="img-thumbnail" width="50px" style="min-width: 40px" src="{{ asset('assets/keyforge/logos/wiki.jpg') }}" alt="Wiki"/></a>
        <a href="https://decksofkeyforge.com/decks/{{ reference }}" target="_blank"><img class="img-thumbnail" width="40px" style="min-width: 40px" src="{{ asset('assets/keyforge/logos/dok.svg') }}" alt="DoK"/></a>
        <a href="https://keyforgegame.com/deck-details/{{ reference }}" target="_blank"><img class="img-thumbnail" width="50px" style="min-width: 50px" src="{{ asset('assets/keyforge/logos/vault.png') }}" alt="Vault"/></a>
        {% if is_granted('ROLE_KEYFORGE') %}
            {% if deck_notes is not null %}
                <button type="button" class="btn btn-dark btn-sm ml-1" style="width: 39px; height: 49px" data-bs-toggle="modal" data-bs-target="#deckUpdateNotes" data-deck-id="{{ deck.id }}"><i class="bi bi-pencil"></i></button>
            {% endif %}
        {% endif %}
    </div>
</div>

<div class="modal fade" id="deckUpdateNotes" tabindex="-1" role="dialog" aria-labelledby="deckUpdateNotes" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modelaTitleLabel">{{ 'deck.notes'|trans }}</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="updateDeckNotesForm">
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <textarea class="form-control" name="notes" id="deckNotesInput" rows="8" maxlength="512"></textarea>
                        </div>
                    </div>

                    <div>
                        <input type="hidden" id="hiddenDeckId" value="">
                    </div>

                    <div class="divider py-1"></div>

                    <button type="submit" id="updateNotesSubmit" class="btn btn-block btn-dark" style="width: 100%">{{ 'deck.save'|trans }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const modal = $('#deckUpdateNotes');

    modal.on('hidden.bs.modal', function () {
        $(this).find('form').trigger('reset');
    });

    modal.on('show.bs.modal', function (event) {
        const button = $(event.relatedTarget);

        $.get({
            url: "/decks/json",
            method: "GET",
            dataType: "json",
            data: {
                'extraDeckId': button.data('deck-id'),
            },
        }).done(function(response) {
            $('#deckNotesInput')[0].value = response.data[0].notes;
        });

        $('#hiddenDeckId')[0].value = button.data('deck-id');
    });

    modal.on('hidden.bs.modal', function () {
        $(this).find('form').trigger('reset');
    });

    $('#updateDeckNotesForm').submit(function (e) {
        e.preventDefault();

        let deckId = $('#hiddenDeckId')[0].value;
        let notes = $('#deckNotesInput')[0].value;

        $.post({
            url: '{{ path('keyforge_deck_update_notes') }}',
            method: 'POST',
            data: {
                'deckId': deckId,
                'notes': notes,
            },
        }).done(function() {
            $('#deckNotesInputDisabled')[0].innerHTML = notes;
            modal.modal('hide');
        });
    });
</script>
